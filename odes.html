
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Modeling evolutionary problems &#8212; Numerical recipes for environmental sciences with MATLAB</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fitting data to models" href="parameterfitting.html" />
    <link rel="prev" title="Reading, writing and plotting data" href="ioplot.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Numerical recipes for environmental sciences with MATLAB</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Numerical recipes for environmental sciences with MATLAB
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intromatlab.html">
   An introduction to MATLAB
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ioplot.html">
   Reading, writing and plotting data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Modeling evolutionary problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parameterfitting.html">
   Fitting data to models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="graphsandnetworks.html">
   Graphs and Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="images.html">
   Working with images
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linearalgebra.html">
   Linear Algebra
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/Cirdans-Home/recipesforenvsciences2024/main?urlpath=tree/src/odes.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Cirdans-Home/recipesforenvsciences2024"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Cirdans-Home/recipesforenvsciences2024/issues/new?title=Issue%20on%20page%20%2Fodes.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/odes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="_sources/odes.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ordinary-differential-equations">
   Ordinary differential equations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-completely-worked-out-example">
   A completely worked out example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chemical-kinetics">
   Chemical kinetics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-simple-epidemiological-model">
   A simple epidemiological model
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Modeling evolutionary problems</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ordinary-differential-equations">
   Ordinary differential equations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-completely-worked-out-example">
   A completely worked out example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chemical-kinetics">
   Chemical kinetics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-simple-epidemiological-model">
   A simple epidemiological model
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="modeling-evolutionary-problems">
<h1>Modeling evolutionary problems<a class="headerlink" href="#modeling-evolutionary-problems" title="Permalink to this headline">#</a></h1>
<p>One of the ways in which mathematics is used to translate experimental
measurements into an understanding of the underlying regulating mechanisms is
represented by <strong>ordinary differential equations</strong>. Indeed if we consider the
values of variables these do not provide themselves insight on the underlying
phenomena we want to describe. The fundamental insight is that is <em>the change
in the magnitude</em> of a variable <em>as a function of time</em> that is the important
quantity. These changes can be often be described in terms of differential
equations.</p>
<p>The first class of problems we will address in this course is then their
numerical solution with MATLAB. To arrive at this we will start by (quickly)
recalling the mathematical background.</p>
<section id="ordinary-differential-equations">
<h2>Ordinary differential equations<a class="headerlink" href="#ordinary-differential-equations" title="Permalink to this headline">#</a></h2>
<p>Let us suppose that we have a variable <span class="math notranslate nohighlight">\(x\)</span> that depends on time <span class="math notranslate nohighlight">\(t\)</span>, we can
represent its evolution on a graph</p>
<a class="reference internal image-reference" href="_images/differentiation.png"><img alt="Differentiation" class="align-center" src="_images/differentiation.png" style="width: 400px;" /></a>
<p>There are intervals during which <span class="math notranslate nohighlight">\(x\)</span> increases and others during which it
decreases. We can denote the <strong>slope</strong> of the change as</p>
<div class="math notranslate nohighlight">
\[\frac{\Delta x}{\Delta t} = \frac{x(t_2) - x(t_1)}{t_2 - t_1} =
\frac{x(t_1 + \Delta t) - x(t_1)}{\Delta t}, \quad \Delta t = t_2 - t_1,\]</div>
<p>when we define it in this way, the <em>slope</em> is a function of the selected
interval.  We are the interested in what happens as we let the time interval
decrease by approaching zero, i.e., <span class="math notranslate nohighlight">\(\Delta t \rightarrow 0\)</span>,</p>
<div class="math notranslate nohighlight">
\[\lim_{\Delta t \rightarrow 0}\frac{\Delta x}{\Delta t} =
\lim_{\Delta t \rightarrow 0} \frac{x(t_1 + \Delta t) - x(t_1)}{\Delta t}
= x'(t) = \frac{ {\rm d} x }{{\rm d} t} = \dot{x}(t),\]</div>
<p>that is, we are interested in its <strong>derivative</strong>. Specifically, we are
interested in making <strong>predictions</strong> about phenomena that are
subject to change, e.g.,</p>
<ul class="simple">
<li><p>the rate at which the food supply for a given specie is related to the growth
of its population,</p></li>
<li><p>the variation of a drug concentration in an organ,</p></li>
<li><p>the rate of decay of a radioactive substance.</p></li>
</ul>
<p>Thus we are particularly interested in equations that tell us how
this rate at which a given quantity changes when it is related to some
function of the quantity itself. In mathematical terms these are equations
of the form</p>
<div class="math notranslate nohighlight">
\[x'(t) = f(t,x(t)), \quad t \in [t_0,t_f].\]</div>
<p>These type of equations are called <strong>ordinary differential equations</strong>. Their
solution cannot be determined uniquely without employing some
<strong>outside condition</strong>. This is typically an <em>initial value</em>, e.g., the quantity
of radioactive material at the beginning of the decay or the number of members
of our population.</p>
<p>There is a very rich mathematical theory behind these objects that is involved
in</p>
<ol class="simple">
<li><p>having strategies useful for the development of models of physical phenomena;</p></li>
<li><p>discovering whether the model we (or our <em>friendly neighborhood
mathematician</em> ) have just devised is <strong>well-posed</strong> ( are there solutions?
are these unique? do the solutions correspond to the phenomenon we were
modeling?);</p></li>
</ol>
<p><strong>But don’t worry</strong>, what we are interested in here is using MATLAB to
investigate them, and approximate their solution 👍. So we will assume that you
have got your ODE from a good dealer, and avoid investigating the theory.</p>
<p>We will start from <strong>an example</strong> doing the whole analysis from top to bottom,
then you will have the opportunity to work on a <strong>gallery of problems</strong> testing
what we have learned.</p>
</section>
<section id="a-completely-worked-out-example">
<h2>A completely worked out example<a class="headerlink" href="#a-completely-worked-out-example" title="Permalink to this headline">#</a></h2>
<p>The model we want to study is an of example of <strong>compartment analysis</strong> related
to the time evolution of a drug concentration in an organ. We let now <span class="math notranslate nohighlight">\(x(t)\)</span>
denote the amount of substance in some compartment at time <span class="math notranslate nohighlight">\(t\)</span>. We can then
compute the change in the quantity <span class="math notranslate nohighlight">\(x(t)\)</span> in terms of the amount of
the quantity flowing into and out the compartment, i.e., we are assuming that
the substance does not “disappear” in the process,</p>
<div class="math notranslate nohighlight">
\[\frac{{\rm d} x(t)}{{\rm d}t} = \text{input rate}\;-\text{output rate},\]</div>
<p>this principle is based on the <strong>law of conservation of mass</strong> and is known as
the <em>Balance Law</em>.</p>
<p>The first example we look at is a simple process of drug administration through
the stomach and the blood</p>
<a class="reference internal image-reference" href="_images/drug1.png"><img alt="A simple drug absorption system" class="align-center" src="_images/drug1.png" style="width: 400px;" /></a>
<p>We enter in the system <span class="math notranslate nohighlight">\(y_0\)</span> unit of drugs (<em>initial condition</em>), then the
quantity of drug that is in the stomach (<em>first compartment</em>) is denoted by
<span class="math notranslate nohighlight">\(y_1(t)\)</span>. From here it can only go to the blood (<em>second compartment</em>) with
a transition rate of <span class="math notranslate nohighlight">\(k_1\)</span>. We denote with <span class="math notranslate nohighlight">\(y_2(t)\)</span> the quantity of drug in
the second compartment, from here then the drug is eliminated through some
metabolic process at rate <span class="math notranslate nohighlight">\(k_e\)</span>. Let us write down the differential model
for this case</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
\dot{y}_1(t) = - k_1 y_1(t), &amp; y_1(0) = y_0, \\
\dot{y}_2(t) = + k_1 y_1(t) - k_e y_2(t), &amp; y_2(0) = 0,
\end{cases} \quad t \in [0,t_f],\end{split}\]</div>
<p>we have written down a system of two differential equations for the quantity of
drug in the two compartments.</p>
<p>We now use MATLAB to get a <strong>numerical solution</strong> of this system. In this case
a numerical solution is nothing more than an evaluation of the two functions
<span class="math notranslate nohighlight">\(y_1(t)\)</span>, and <span class="math notranslate nohighlight">\(y_2(t)\)</span> over a grid of time values</p>
<div class="math notranslate nohighlight">
\[0 = t_1 &lt; t_2 &lt; \ldots &lt; t_n = t_f.\]</div>
<p>Let us start by creating a <code class="docutils literal notranslate"><span class="pre">matlab</span> <span class="pre">script</span></code> called <code class="docutils literal notranslate"><span class="pre">drugdelivery.m</span></code>.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% Drug Delivery</span><span class="w"></span>
<span class="c">% This script will be used to solve a simple drug-delivery model in the form</span><span class="w"></span>
<span class="c">% of two linear coupled odes</span><span class="w"></span>

<span class="nb">clear</span><span class="p">;</span><span class="w"> </span><span class="nb">clc</span><span class="p">;</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="s">all</span><span class="p">;</span><span class="w"> </span><span class="c">% Clean the memory</span><span class="w"></span>
</pre></div>
</div>
<p>In MATLAB you can specify any number of coupled ODE equations to solve, and
at least in principle the number of equations is only limited by the available
computer memory. In our case we can specify our <em>dynamics</em> by using a <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">handle</span></code>, by adding to the previous script</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">k1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.9776</span><span class="p">;</span><span class="w">      </span><span class="c">% Transition rate between stomach and blood</span><span class="w"></span>
<span class="n">ke</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.2213</span><span class="p">;</span><span class="w">      </span><span class="c">% Eliminatio rate from the blood</span><span class="w"></span>
<span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="o">-</span><span class="n">k1</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k1</span><span class="w"> </span><span class="o">-</span><span class="n">ke</span><span class="p">];</span><span class="w"> </span><span class="c">% Two by two matrix</span><span class="w"></span>
<span class="n">f</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">A</span><span class="o">*</span><span class="n">y</span><span class="p">;</span><span class="w">   </span><span class="c">% Right-hand side of the ODE</span><span class="w"></span>
</pre></div>
</div>
<p>We have firs fixed the values of the two constants for the model. Then we
have rewritten the right-hand side of the model as a matrix vector product</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{
\begin{bmatrix}
y_1(t)\\y_2(t)
\end{bmatrix}} = \begin{bmatrix}
-k_1 &amp; 0 \\
+k_1 &amp; -k_e
\end{bmatrix}\begin{bmatrix}
y_1(t)\\y_2(t)
\end{bmatrix} \Leftrightarrow \dot{\mathbf{y}} = A \mathbf{y} = f(t,\mathbf{y}).\end{split}\]</div>
<p>in a <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">handle</span></code> form. That is, we can call <code class="docutils literal notranslate"><span class="pre">f(t,y)</span></code> to evaluate the
dynamics.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The dynamics of the system must always be expressed with the arguments in this
order: first the independent variable (<span class="math notranslate nohighlight">\(t\)</span>), then the function (<span class="math notranslate nohighlight">\(\mathbf{y}\)</span>).
MATLAB expects it to be this way!</p>
</div>
<p>The other two data from the system that we need are the <em>initial condition</em>,
and the maximum time <span class="math notranslate nohighlight">\(t_f\)</span>. We can add them to the script by doing</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">y0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">600</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="c">% firt component is the initial condition for y1, the second for y2</span><span class="w"></span>
<span class="n">t0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">tf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Now we have specified all the needed data and we can use one of the MATLAB
<strong>ODE integrator</strong> to solve the system</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">T</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ode45</span><span class="p">(@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">),[</span><span class="n">t0</span><span class="p">,</span><span class="n">tf</span><span class="p">],</span><span class="n">y0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>After this call had been executed the variable <code class="docutils literal notranslate"><span class="pre">T</span></code> will contain the values</p>
<div class="math notranslate nohighlight">
\[0 = t_1 &lt; t_2 &lt; \ldots &lt; t_n = t_f\]</div>
<p>on which we have approximated the solution, while <span class="math notranslate nohighlight">\(Y\)</span> will be a
<span class="math notranslate nohighlight">\(\operatorname{lenght}(T) \times 2\)</span> matrix containing the approximation of the
two solutions on each time step. We can visualize what we have obtained by
doing</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="nb">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">Y</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;r-&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;T (h)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;y_1(t)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="nb">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">Y</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="s">&#39;r-&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;T (h)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;y_2(t)&#39;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>and obtaining the two figures</p>
<table class="table" id="id1">
<caption><span class="caption-number">Table 8 </span><span class="caption-text">Simple drug delivery solutions</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Compartment 1, stomach: <span class="math notranslate nohighlight">\(y_1(t)\)</span></p></th>
<th class="head"><p>Compartment 2, blood: <span class="math notranslate nohighlight">\(y_2(t)\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><img alt="" src="_images/drug1-res1.png" /></p></td>
<td><p><img alt="" src="_images/drug1-res2.png" /></p></td>
</tr>
</tbody>
</table>
<p>From which we observe somehow the expected behavior. The quantity of drug in
the stomach (first compartment on the left) decreases with the time, while the
quantity in the bloodstream starts (second compartment on the right) to
increase, but since it is also eliminated from there with rate <span class="math notranslate nohighlight">\(k_e\)</span> it shows
that hump.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">ode45</span></code> performs well with <em>most</em> ODE problems and should generally be your
first choice of solver. However, <code class="docutils literal notranslate"><span class="pre">ode23</span></code>, <code class="docutils literal notranslate"><span class="pre">ode78</span></code>, <code class="docutils literal notranslate"><span class="pre">ode89</span></code> and <code class="docutils literal notranslate"><span class="pre">ode113</span></code> can
be more efficient than <code class="docutils literal notranslate"><span class="pre">ode45</span></code> for problems with looser or tighter accuracy
requirements.</p>
<p>Some ODE problems exhibit <strong>stiffness</strong>. Stiffness is a term that defies a
precise definition, but in general, stiffness occurs when there is a
difference in scaling somewhere in the problem. For example, if an ODE has
two solution components that vary on drastically different time scales,
then the equation might be stiff. You can <strong>identify a problem as stiff</strong> if
<em>nonstiff</em> solvers (such as <code class="docutils literal notranslate"><span class="pre">ode45</span></code>) are unable to solve the problem or are
extremely slow. If you observe that a nonstiff solver is very slow, try using
a stiff solver such as <code class="docutils literal notranslate"><span class="pre">ode15s</span></code> instead.</p>
</div>
<p>Let us <strong>summarize</strong> the different steps we need for a program solving an ODE
(a system of ODEs),</p>
<ol class="simple">
<li><p>we <em>implement</em> in either a <em>function</em> or a <em>function handle</em> the <strong>dynamics of
the system</strong>;</p></li>
<li><p>we create a vector containing the <strong>initial condition</strong>;</p></li>
<li><p>we fix the time interval <code class="docutils literal notranslate"><span class="pre">[t0,tf]</span></code> on which we want to solve our problem;</p></li>
<li><p>we call an ODE solver (typically <code class="docutils literal notranslate"><span class="pre">ode45</span></code> or <code class="docutils literal notranslate"><span class="pre">ode15s</span></code>) using all these data.</p></li>
</ol>
<div class="admonition-remark admonition">
<p class="admonition-title">Remark</p>
<p>Instead of just <code class="docutils literal notranslate"><span class="pre">[t0,tf]</span></code> we could pass to the integrator the whole vector of
time steps we want to use. A canonical way for doing so is, e.g., by generating
a linearly spaced vector such has</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">linspace</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">tf</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>This can be useful if we want the (approximate) solution to be evaluated at
certain time steps.</p>
<p>If we are uncertain at the beginning on what time steps we may be interested
MATLAB offers us a routine to query the solution at any point between <code class="docutils literal notranslate"><span class="pre">[t0,tf]</span></code>.
To use it we need to slightly change the way in which we call the ODE solver:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ode45</span><span class="p">(@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">),[</span><span class="n">t0</span><span class="p">,</span><span class="n">tf</span><span class="p">],</span><span class="n">y0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">sol</span></code> will be a <code class="docutils literal notranslate"><span class="pre">struct</span></code> variable, in the case of this example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">sol</span> <span class="o">=</span>

  struct with fields:

     solver: <span class="s1">&#39;ode45&#39;</span>
    extdata: <span class="o">[</span><span class="m">1</span>×1 struct<span class="o">]</span>
          x: <span class="o">[</span><span class="m">1</span>×20 double<span class="o">]</span>
          y: <span class="o">[</span><span class="m">2</span>×20 double<span class="o">]</span>
      stats: <span class="o">[</span><span class="m">1</span>×1 struct<span class="o">]</span>
      idata: <span class="o">[</span><span class="m">1</span>×1 struct<span class="o">]</span>
</pre></div>
</div>
<p>The information that was contained before in the <code class="docutils literal notranslate"><span class="pre">T</span></code> vector is in <code class="docutils literal notranslate"><span class="pre">sol.x</span></code>, while
what we had stored in the <code class="docutils literal notranslate"><span class="pre">Y</span></code> matrix is in <code class="docutils literal notranslate"><span class="pre">sol.y</span></code>.</p>
<p>Now let us say that we want to know the quantity of the drug in the bloodstream
after 2 hours, we find it by doing</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">drug_in_blood</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">deval</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">deval</span></code> we have used takes as a first argument the <code class="docutils literal notranslate"><span class="pre">struct</span></code> coming
from the ODE solver, as second the point <span class="math notranslate nohighlight">\(t \in [t_0,t_f]\)</span> on which we want
the solution, and as last argument what component of the solution we want.
In this case we have queried for the vale in the second <em>compartment</em>.</p>
</div>
<p>To see if we have understood how to work with this type of models you can try
and solve the following variations on the theme, that have either different
interactions, or a larger number of <em>compartments</em>.</p>
<div class="exercise admonition" id="odes-exercise-0">

<p class="admonition-title"><span class="caption-number">Exercise 4 </span> (Drug administration through blood and tissue)</p>
<section id="exercise-content">
<p>In this model, there are again only two <em>compartments</em>. The first one is the
bloodstream into which the drug is injected and the second one is the tissue
where the drug has the desired effect. The blood takes a part
of drug at the rate of <span class="math notranslate nohighlight">\(k_b\)</span> onto tissue while a fraction of it gets
eliminated from the stream with elimination rate of <span class="math notranslate nohighlight">\(k_e\)</span>.</p>
<a class="reference internal image-reference" href="_images/drug2.png"><img alt="Drug administration through blood and tissue" class="align-center" src="_images/drug2.png" style="width: 400px;" /></a>
<ol class="simple">
<li><p>Write down the set of two differential equations for this model,</p></li>
<li><p>Use MATLAB to simulate the solution for <span class="math notranslate nohighlight">\(y_0 = 500\)</span>, <span class="math notranslate nohighlight">\(k_b = 0.5\)</span>,
<span class="math notranslate nohighlight">\(k_e = 0.05\)</span> and <span class="math notranslate nohighlight">\(k_t = 0.25\)</span> again on a 6 h interval.</p></li>
</ol>
<div class="tip dropdown admonition">
<p class="admonition-title">ODEs</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\mathbf{y}} = \begin{bmatrix}
-(k_b + k_e) &amp; k_t \\
k_b &amp; -k_t
\end{bmatrix} \mathbf{y}, \quad \mathbf{y} = \begin{bmatrix}
y_1(t)\\ y_2(t)
\end{bmatrix}, \quad \mathbf{y}_0 =  \begin{bmatrix}
y_0\\ 0
\end{bmatrix}.\end{split}\]</div>
</div>
</section>
</div>
<div class="exercise admonition" id="odes-exercise-1">

<p class="admonition-title"><span class="caption-number">Exercise 5 </span> (…through arterial blood, tissue and venous blood)</p>
<section id="exercise-content">
<p>Another model can be obtained by considering that the blood flow in
cardiovascular system is one directional. Thus we can administer our drug
through arterial blood:</p>
<a class="reference internal image-reference" href="_images/drug3.png"><img alt="Drug administration through blood and tissue" class="align-center" src="_images/drug3.png" style="width: 600px;" /></a>
<p>The consumption of drug by arterial blood towards tissue has a rate <span class="math notranslate nohighlight">\(k_b\)</span>,
from tissue compartment to the venous bloodstream has rate <span class="math notranslate nohighlight">\(k_t\)</span>. Then the
kidneys and liver excrete the drug from the bloodstream with rate <span class="math notranslate nohighlight">\(k_e\)</span>.</p>
<ol class="simple">
<li><p>Write down the set of three differential equations for this model,</p></li>
<li><p>Use MATLAB to simulate the solution for <span class="math notranslate nohighlight">\(y_0 = 500\)</span>, <span class="math notranslate nohighlight">\(k_b = 0.9776\)</span>,
<span class="math notranslate nohighlight">\(k_e = 0.2213\)</span>, and <span class="math notranslate nohighlight">\(k_t = 0.3293\)</span> again on a 6 h interval.</p></li>
</ol>
<div class="tip dropdown admonition">
<p class="admonition-title">ODEs</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\mathbf{y}} = \begin{bmatrix}
-k_b &amp; 0 &amp; 0 \\
k_b &amp; -k_t &amp; 0 \\
0 &amp; k_t &amp; -k_e
\end{bmatrix} \mathbf{y}, \quad \mathbf{y} = \begin{bmatrix}
y_1(t)\\ y_2(t)\\ y_3(t)
\end{bmatrix}, \quad \mathbf{y}_0 =  \begin{bmatrix}
y_0\\ 0 \\ 0
\end{bmatrix}.\end{split}\]</div>
</div>
</section>
</div>
</section>
<section id="chemical-kinetics">
<h2>Chemical kinetics<a class="headerlink" href="#chemical-kinetics" title="Permalink to this headline">#</a></h2>
<p>Another class of problems that ends up producing ODEs are the one coming from
<strong>chemical kinetics</strong>, as you sure know better than me, this is the study of
the rates of chemical reactions. The following examples focus on a couple of
reaction mechanisms for which we can find ODEs that will allow us to calculate
the concentration of the different species that take part of the reaction
during the whole reaction time.</p>
<div class="admonition-oscillating-reactions admonition">
<p class="admonition-title">Oscillating reactions</p>
<p>Let us consider the following chemical reactions:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{c}
A + X \overset{k_1}{\longrightarrow} 2X,\\
X + Y \overset{k_2}{\longrightarrow} 2Y,\\
Y \overset{k_3}{\longrightarrow} B,\\
\end{array}\end{split}\]</div>
<p>in which each reaction step refers to the molecular mechanism
by which the reactant molecules combine produce some intermediate products
before yielding the final one. In the first step a molecule of species <span class="math notranslate nohighlight">\(A\)</span>
combines with a molecule of species <span class="math notranslate nohighlight">\(X\)</span> yielding two molecules of species <span class="math notranslate nohighlight">\(X\)</span>.
This step consumes molecules of species <span class="math notranslate nohighlight">\(A\)</span> in favor of molecules of species
<span class="math notranslate nohighlight">\(X\)</span> at a rate that is proportional to the product of the concentrations of <span class="math notranslate nohighlight">\(A\)</span>
and <span class="math notranslate nohighlight">\(X\)</span>.</p>
<p>If we write down the system of differential equations for this formulation
we get</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
\frac{{\rm d} [A]}{{\rm d} t} = -k_1 [A] [X], \\
\frac{{\rm d} [X]}{{\rm d} t} = +k_1 [A] [X] -k_2 [X][Y],\\
\frac{{\rm d} [Y]}{{\rm d} t} = +k_2 [X] [Y] -k_3 [Y],\\
\frac{{\rm d} [B]}{{\rm d} t} = -k_3 [Y],
\end{cases}\end{split}\]</div>
<p>that are four differential equations in four variables.</p>
<p>It is <strong>important to observe</strong> that for this case, the equations are <strong>nonlinear</strong>:
they depend on the product of variables, i.e., we cannot represent them as we
have done for the other examples in matrix form.</p>
<p>To solve this system we will make some assumptions, and observation</p>
<ol class="simple">
<li><p>the concentration of the reactant <span class="math notranslate nohighlight">\(A\)</span> is held constant: somebody is feeding
the system at a rate equal to <span class="math notranslate nohighlight">\(k_1\)</span> a supply of <span class="math notranslate nohighlight">\(A\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\frac{ {\rm d} [A]+[X]+[Y]+[B] }{{\rm d}t} = 0\)</span>, so <span class="math notranslate nohighlight">\([A]+[X]+[Y]+[B]\)</span> is
constant,</p></li>
<li><p>at the beginning there is no <span class="math notranslate nohighlight">\([B]\)</span>, thus <span class="math notranslate nohighlight">\([A]+[B]+[X]+[Y] = [A]_ 0 +[X]_ 0 +[Y]_ 0\)</span>,</p></li>
</ol>
<p>This means that we do not need to solve the last equation, we can just compute
<span class="math notranslate nohighlight">\([B] = [X]_ 0 - X + [Y]_ 0 - Y\)</span>, and the first equation is also solved because
we have decided to make the quantity of <span class="math notranslate nohighlight">\([A]\)</span> constant. We have thus reduced
to solving the system</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
\frac{{\rm d} [X]}{{\rm d} t} = +k_1 [A]_0 [X] -k_2 [X][Y],\\
\frac{{\rm d} [Y]}{{\rm d} t} = +k_2 [X] [Y] -k_3 [Y],
\end{cases}\end{split}\]</div>
<p>We can write the dynamics in MATLAB again as a <em>function handle</em>, after we
have defined the constants <code class="docutils literal notranslate"><span class="pre">k1</span></code>, <code class="docutils literal notranslate"><span class="pre">k2</span></code>, and <code class="docutils literal notranslate"><span class="pre">A0</span></code> by writing</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="n">k1</span><span class="o">*</span><span class="n">A0</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">k2</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">k3</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">)];</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="a-simple-epidemiological-model">
<h2>A simple epidemiological model<a class="headerlink" href="#a-simple-epidemiological-model" title="Permalink to this headline">#</a></h2>
<p>We consider again a compartmental model, but this time for the spread of an
epidemics in a population. We first partition the host population into three
compartments:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(S\)</span> susceptible hosts,</p></li>
<li><p><span class="math notranslate nohighlight">\(I\)</span> infectious hosts,</p></li>
<li><p><span class="math notranslate nohighlight">\(R\)</span> recovered hosts.
The objective of our modeling effort is again to track the number of hosts in
each of the three compartments at any given time <span class="math notranslate nohighlight">\(t\)</span>, that is we want to
know the functions <span class="math notranslate nohighlight">\(S(t)\)</span>, <span class="math notranslate nohighlight">\(I(t)\)</span>, and <span class="math notranslate nohighlight">\(R(t)\)</span>.</p></li>
</ul>
<p>By applying again the conservation principle, we know that the net change of
the number of hosts in a compartment can be expressed as the difference between
the number coming into the compartment and the number leaving it during the
time interval under consideration:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{split}
\Delta S(t) = &amp; \text{&quot;new susceptible&quot;} + \text{&quot;transfer from &quot;}R - \text{&quot;new infections&quot;} - \text{&quot;removal from &quot;}S, \\
\Delta I(t) = &amp; \text{&quot;new infections&quot;} - \text{&quot;transfer into &quot;}R - \text{&quot;removal from &quot;}I,\\
\Delta R(t) = &amp; \text{&quot;transfer from &quot;}I - \text{&quot;transfer into &quot;}S - \text{&quot;removal from &quot;}R,
\end{split}\end{split}\]</div>
<p>then we divide both sides by <span class="math notranslate nohighlight">\(\Delta t\)</span>, and we let it go to 0, <span class="math notranslate nohighlight">\(\Delta t \rightarrow 0\)</span>,
we find the derivatives of the tree functions <span class="math notranslate nohighlight">\(S(t)\)</span>, <span class="math notranslate nohighlight">\(I(t)\)</span>, and <span class="math notranslate nohighlight">\(R(t)\)</span> on the
left-hand side, and the <em>transfer rate</em> on the right-hand side. Succinctly:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
S'(t) = - \lambda I S, &amp; S(0) = S_0 &gt; 0\\
I'(t) = \lambda I S - \gamma I, &amp; I(0) = I_0 &gt; 0,\\
R'(t) = \gamma I, &amp; R(0) = R_0.
\end{cases}\end{split}\]</div>
<p>Where have <strong>assumed</strong> that</p>
<ul class="simple">
<li><p>transmission occurs through direct contact between hosts;</p></li>
<li><p>the <em>incidence rate</em>, that is the number of new infections per unit time, can
be expressed as <span class="math notranslate nohighlight">\(\lambda I(t) S(t)\)</span> for a given <em>transmission coefficient</em> <span class="math notranslate nohighlight">\(\lambda\)</span>,</p></li>
<li><p>the <em>recovery rate</em> can be written as <span class="math notranslate nohighlight">\(\gamma I(t)\)</span> for some constant rate <span class="math notranslate nohighlight">\(\gamma\)</span>,</p></li>
<li><p>the population is fixed, there is no possibility of being reinfected after healing.</p></li>
</ul>
<p>These assumptions will be much or less reasonable depending on the the infectious
disease. For our illustrative needs, this simple model will be good enough.</p>
<p>Now we have our system of ODEs together with the initial condition, so given
some values for the constants <span class="math notranslate nohighlight">\(\lambda\)</span>, <span class="math notranslate nohighlight">\(\gamma\)</span>, <span class="math notranslate nohighlight">\(S_0\)</span> and <span class="math notranslate nohighlight">\(I_0\)</span> we could jump
right in and apply one of the numerical integrator from MATLAB to get the
solution. <strong>However</strong> we can slightly simplify the model by observing that</p>
<div class="math notranslate nohighlight">
\[N = S(t) + I(t) + R(t) = S(0) + I(0) + R(0) = S(0) + I(0),\]</div>
<p>therefore <span class="math notranslate nohighlight">\(d N / d t = 0\)</span>, and thus we don’t need to solve the equation for <span class="math notranslate nohighlight">\(R(t)\)</span>, since</p>
<div class="math notranslate nohighlight">
\[R(t) = N - S(t) - I(t).\]</div>
<p>Now let us <strong>build a simulation</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">clear</span><span class="p">;</span><span class="w"> </span><span class="nb">clc</span><span class="p">;</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="s">all</span><span class="w"></span>

<span class="n">N</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">261</span><span class="p">;</span><span class="w">         </span><span class="c">% Size of the population</span><span class="w"></span>
<span class="n">I0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w">          </span><span class="c">% Initially infected</span><span class="w"></span>
<span class="n">S0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">N</span><span class="o">-</span><span class="n">I0</span><span class="p">;</span><span class="w">       </span><span class="c">% Number of susceptible individuals</span><span class="w"></span>
<span class="n">lambda</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.0178</span><span class="p">;</span><span class="w"> </span><span class="c">% Transmission coefficient</span><span class="w"></span>
<span class="nb">gamma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">2.73</span><span class="p">;</span><span class="w">    </span><span class="c">% Recovery rate</span><span class="w"></span>

<span class="c">% We order the variables as y(t) = [S(t),I(t)]</span><span class="w"></span>
<span class="n">f</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="n">lambda</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">lambda</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="nb">gamma</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">)];</span><span class="w"></span>
<span class="p">[</span><span class="n">T</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ode45</span><span class="p">(@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1000</span><span class="p">),[</span><span class="n">S0</span><span class="p">;</span><span class="n">I0</span><span class="p">]);</span><span class="w"></span>

<span class="c">% We plot the three curves on the same graph</span><span class="w"></span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="nb">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">Y</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;r-&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span><span class="p">,</span><span class="n">Y</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="s">&#39;b-&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">Y</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">Y</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="s">&#39;c-&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span><span class="p">,</span><span class="n">N</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span><span class="s">&#39;k--&#39;</span><span class="p">,</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Time&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Population&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">legend</span><span class="p">({</span><span class="s">&#39;S(t)&#39;</span><span class="p">,</span><span class="s">&#39;Y(t)&#39;</span><span class="p">,</span><span class="s">&#39;R(t)&#39;</span><span class="p">},</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;best&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">axis</span><span class="w"> </span><span class="n">tight</span><span class="w"></span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="nb">plot</span><span class="p">(</span><span class="n">Y</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">Y</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;S(t)&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Y(t)&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/odes_1_0.png" src="_images/odes_1_0.png" />
</div>
</div>
<p>The parameters in this example have been obtained from the <em>great plague in Eyam</em>,
a village near Sheffield in England from 1665-1666 (possibly a secondary outbreak
from the <em>Great Plague of London</em>). The Plague was survived only by 83 people of
an original population of 350. Observe that the data here starts from a smaller
population, i.e., we are neglecting the initial insurgence, <span class="math notranslate nohighlight">\(S(0) = 254\)</span>, <span class="math notranslate nohighlight">\(I(0) = 7\)</span>.</p>
<p>The infective period of the bubonic plague can be estimated to be around 11 days,
and this gives a value of <span class="math notranslate nohighlight">\(\lambda = 0.0178\)</span> and a value of <span class="math notranslate nohighlight">\(\beta = 2.73\)</span>. To
obtain these values we have used a couple of mathematical observations. If we sum
the two equations for <span class="math notranslate nohighlight">\(S'(t)\)</span> and <span class="math notranslate nohighlight">\(I'(t)\)</span> we find</p>
<div class="math notranslate nohighlight">
\[(S + I)' = - \alpha I &lt; 0,\]</div>
<p>thus this a decreasing positive function, henceforth it has a finite limit, and
since <span class="math notranslate nohighlight">\(\lim_{t\rightarrow +\infty} I(t) = 0\)</span>, this limit is equal to the total
number of susceptible hosts at the end of the epidemics. By performing some
integrals (out of our scope) one finds that</p>
<div class="math notranslate nohighlight">
\[\log \frac{S_0}{S_\infty} = \frac{\lambda}{\gamma} [1 - \frac{S_\infty}{N}] = \mathcal{R}_0 [1 - \frac{S_\infty}{N}],\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{R}_0\)</span> is called the basic reproduction number. As you may have
heard lately, then to prevent the occurrence of an epidemic it is then necessary
to reduce <span class="math notranslate nohighlight">\(\mathcal{R}_0\)</span> below the threshold of <span class="math notranslate nohighlight">\(1\)</span>.</p>
<p>As an <strong>exercise</strong> you can try to play around with the parameters of this model
to generate the different outcomes of an epidemic obeying it.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "matlab"
        },
        kernelOptions: {
            kernelName: "matlab",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'matlab'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="ioplot.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Reading, writing and plotting data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="parameterfitting.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Fitting data to models</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Fabio Durastante<br/>
  
      &copy; Copyright 2024.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>